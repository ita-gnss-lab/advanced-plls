#!/bin/bash
# Simple post-checkout hook to refresh submodules on branch switches.

# Only run when a branch switch occurs.
if [ "$3" != "1" ]; then
    exit 0
fi

echo "Branch switch detected: refreshing submodules..."

# Deinitialize all submodules (suppress any errors)
git submodule deinit -f . 2>/dev/null

# If .gitmodules exists, remove each submodule directory entirely.
if [ -f .gitmodules ]; then
    # Get each submodule path listed in .gitmodules.
    for submodule in $(git config -f .gitmodules --get-regexp '^submodule\..*\.path$' | awk '{print $2}'); do
        if [ -d "$submodule" ]; then
            echo "Removing $submodule..."
            rm -rf "$submodule"
        fi
    done
fi

# Reinitialize and update submodules
git submodule update --init --recursive

echo "Submodules updated."
