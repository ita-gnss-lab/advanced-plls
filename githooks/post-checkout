#!/bin/bash
# Simple post-checkout hook to refresh submodules on branch switches.

# Only run when a branch switch occurs (third parameter equals "1")
if [ "$3" != "1" ]; then
    exit 0
fi

echo "Branch switch detected: refreshing submodules..."

# Deinitialize all submodules (suppress errors)
git submodule deinit -f . 2>/dev/null

# Remove the entire 'libs' folder if it exists,
# ensuring that no leftover submodule content remains.
if [ -d "libs" ]; then
    echo "Removing entire libs directory..."
    chmod -R u+w libs
    rm -rf libs
fi

# Reinitialize and update submodules
git submodule update --init --recursive

echo "Submodules updated."
