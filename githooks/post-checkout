#!/bin/bash
# A simple post-checkout hook to update submodules on branch switches.

# Check if the checkout is due to a branch switch (third parameter equals "1")
if [ "$3" = "1" ]; then
  echo "Branch switch detected: Updating submodules..."

  # Deinitialize all submodules
  git submodule deinit -f .

  # If .gitmodules exists, remove each submodule folder listed in it
  if [ -f .gitmodules ]; then
    echo "Cleaning up and removing $submodule_path..."
    # Remove all files (including hidden ones) inside the directory.
    rm -rf "$submodule_path"/.[!.]* "$submodule_path"/*
    # Attempt to remove the directory itself.
    rm -rf "$submodule_path"
  fi

  # Reinitialize and update submodules
  git submodule update --init --recursive
  echo "Submodules updated."
fi
